<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track geo code changes in all regional granularity in Norway • norgeo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Track geo code changes in all regional granularity in Norway">
<meta property="og:description" content="Regional granularity levels in Norway which are depicted by different codes, 
             have undergone several changes over the years. 
             Identifying when codes have changed and how many changes have taken place
             can be troublesome. This package will help to identify these changes and when the changes
             have taken place. One of the limitation of this package is that it is heavily depending 
             on the codes available from SSB website. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">norgeo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li class="dropdown-header">Version 0.9.0</li>
    <li class="divider">
    <li>
      <a href="news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/folkehelseprofil/norgeo/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="norgeo" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#norgeo" class="anchor"></a>norgeo</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>Regional granularity levels in Norway which are depicted by different codes, have undergone several changes over the years. Identifying when codes have changed and how many changes have taken place can be troublesome. This package will help to identify these changes and when the changes have taken place. One of the limitation of this package is that it is heavily depending on the codes available from SSB which can be accessed from their <a href="https://www.ssb.no/befolkning/artikler-og-publikasjoner/regionale-endringer-2020">website</a>. To use other data than the data structure should mimic those from SSB.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><code>norgeo</code> package can be installed directly from <strong>GitHub</strong> page of <a href="https://github.com/folkehelseprofil">Folkehelseprofil</a>. You can run the code below for installation. It will use <code>remotes</code> package to access to the <strong>GitHub</strong>. If you haven’t installed it before, the package will be installed automatically prior to installing <code>norgeo</code>.</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">remotes</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"folkehelseprofil/norgeo"</span>)</pre></div>
</div>
<div id="track-code-changes" class="section level2">
<h2 class="hasAnchor">
<a href="#track-code-changes" class="anchor"></a>Track code changes</h2>
<p>You have to download the files from SSB and save it as a <code>csv</code> file. For the code changes, they have to be copied and pasted into an Excel file. These code changes can be found under <em>Endringer</em> tab in the website. It’s advisable to name the file with a specific word to differentiate the file from the <code>csv</code> files. I would recommed to add the word <code>change</code>. For example <code>fylke_change_jan2018.xlsx</code> and the downloaded <code>csv</code> file will be <code>fylke_jan2018.csv</code>. It’s also advisable to add the year to all files to easily differentiate them when running the code. Check the suggested structure <a href="#file-structure">here</a> for naming files.</p>
<div id="add-changes" class="section level3">
<h3 class="hasAnchor">
<a href="#add-changes" class="anchor"></a>Add changes</h3>
<p>The <code>geo_set()</code> function is the most important function to start with. This function will create an object that is easily used by other available functions in <code>norgeo</code>. This is where raw data in <code>csv</code> and <code>xlsx</code> formats will be merged. Additional information will also be added. The codes below show how the function is used:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co">## specify the folder where kommune files are</span>
<span class="no">folder</span> <span class="kw">&lt;-</span> <span class="st">"F:/org/kommune"</span>

<span class="no">kom2018</span> <span class="kw">&lt;-</span> <span class="fu">geo_set</span>(<span class="kw">grep.file</span> <span class="kw">=</span> <span class="st">"jan2018"</span>,
                   <span class="kw">grep.change</span> <span class="kw">=</span> <span class="st">"change"</span>,
                   <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2018</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="st">"kommune"</span>,
                   <span class="kw">folder.path</span> <span class="kw">=</span> <span class="no">folder</span>)

<span class="no">kom2019</span> <span class="kw">&lt;-</span> <span class="fu">geo_set</span>(<span class="kw">grep.file</span> <span class="kw">=</span> <span class="st">"jan2019"</span>,
                   <span class="kw">grep.change</span> <span class="kw">=</span> <span class="st">"change"</span>,
                   <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2019</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="st">"kommune"</span>,
                   <span class="kw">folder.path</span> <span class="kw">=</span> <span class="no">folder</span>)

<span class="no">kom2020</span> <span class="kw">&lt;-</span> <span class="fu">geo_set</span>(<span class="kw">grep.file</span> <span class="kw">=</span> <span class="st">"jan2020"</span>,
                   <span class="kw">grep.change</span> <span class="kw">=</span> <span class="st">"change"</span>,
                   <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2020</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="st">"kommune"</span>,
                   <span class="kw">folder.path</span> <span class="kw">=</span> <span class="no">folder</span>)</pre></div>
</div>
<div id="merge-changes" class="section level3">
<h3 class="hasAnchor">
<a href="#merge-changes" class="anchor"></a>Merge changes</h3>
<p>To merge all these files into a big dataset, use <code>geo_merge()</code> function. Important to note that input for <code>geo_merge()</code> must be a <strong>list</strong> and they are arranged from oldest to most recent codes. Available output includes:</p>
<ul>
<li>
<code>all</code> : All merged codes. This is the default</li>
<li>
<code>change</code> : Only codes that have changed</li>
<li>
<code>split</code> : Codes that have been divided to at least two codes in the current list</li>
<li>
<code>merge</code> : At least two codes are merged into one in the current list</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb3"><pre class="r">
<span class="no">komfiles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">kom2018</span>, <span class="no">kom2019</span>, <span class="no">kom2020</span>)
<span class="no">DF</span> <span class="kw">&lt;-</span> <span class="fu">geo_merge</span>(<span class="kw">files</span> <span class="kw">=</span> <span class="no">komfiles</span>)

<span class="co"># show only codes that have changed</span>
<span class="no">DFS</span> <span class="kw">&lt;-</span> <span class="fu">geo_merge</span>(<span class="kw">files</span> <span class="kw">=</span> <span class="no">komfiles</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"split"</span>)</pre></div>
</div>
<div id="save-codes" class="section level3">
<h3 class="hasAnchor">
<a href="#save-codes" class="anchor"></a>Save codes</h3>
<p>The output created from <code>geo_merge()</code> i.e <code>DF</code>, can be saved in a database management system (DBMS) which include Access and SQLite, or as ordinary files such as Excel or text file.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">fpath</span> <span class="kw">=</span> <span class="st">"C:/Users/ybka/dbms"</span>

<span class="fu">geo_save</span>(<span class="kw">tblname</span> <span class="kw">=</span> <span class="st">"tblTest"</span>,
         <span class="kw">obj</span> <span class="kw">=</span> <span class="no">DF</span>,
         <span class="kw">des.path</span> <span class="kw">=</span> <span class="no">fpath</span>,
         <span class="kw">file.type</span> <span class="kw">=</span> <span class="st">"Excel"</span>)</pre></div>
</div>
</div>
<div id="add-granularity" class="section level2">
<h2 class="hasAnchor">
<a href="#add-granularity" class="anchor"></a>Add granularity</h2>
<p>The function <code>geo_cast()</code> will add lower granularity to all files when applicable. It means for <em>kommune</em> files, a new <code>fylke</code> column will be added, while column <code>fylke</code> and <code>kommune</code> will be added to a <em>bydel</em> and <em>grunnkrets</em> files.</p>
<div class="sourceCode" id="cb5"><pre class="r">
<span class="co">## Geo 2019</span>
<span class="no">file2019</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"F:/Geo/fylke/fylke_jan2019.csv"</span>,
              <span class="st">"F:/Geo/kommune/kommune_jan2019.csv"</span>,
              <span class="st">"F:/Geo/bydel/bydel_jan2019.csv"</span>,
              <span class="st">"F:/Geo/grunnkrets/grunnkrets_jan2019.csv"</span>)

<span class="no">fileTyp2019</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fylke"</span>, <span class="st">"kommune"</span>, <span class="st">"bydel"</span>, <span class="st">"grunnkrets"</span>)


<span class="no">DF2019</span> <span class="kw">&lt;-</span> <span class="fu">geo_cast</span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">file2019</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="no">fileTyp2019</span>,
                   <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2019</span>)

<span class="co">## Geo 2020</span>
<span class="no">file2020</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"F:/Geo/fylke/fylke_jan2020.csv"</span>,
              <span class="st">"F:/Geo/kommune/kommune_jan2020.csv"</span>,
              <span class="st">"F:/Geo/bydel/bydel_jan2020.csv"</span>,
              <span class="st">"F:/Geo/grunnkrets/grunnkrets_jan2020.csv"</span>)

<span class="no">fileTyp2020</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fylke"</span>, <span class="st">"kommune"</span>, <span class="st">"bydel"</span>, <span class="st">"grunnkrets"</span>)


<span class="no">DF2020</span> <span class="kw">&lt;-</span> <span class="fu">geo_cast</span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">file2020</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="no">fileTyp2020</span>,
                   <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2020</span>)</pre></div>
<p>Running <code>geo_cast()</code> will also add a new row for granularity <code>land</code> which has code <code>0</code>. The output from the above example can then be merged to a file and saved to the file type one wishes. To bind all the output, you can use the base R <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> function or <code>rbindlist()</code> function from <code>data.table</code> package.</p>
<div class="sourceCode" id="cb6"><pre class="r">
<span class="no">bigDF</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">DF2019</span>, <span class="no">DF2020</span>)</pre></div>
<p>To save the final result, <code>geo_save()</code> function can be used as explained above. Database file must be available prior to saving it as a database table. In the example below it’s <code>geo_ssb.accdb</code>.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">dbpath</span> <span class="kw">=</span> <span class="st">"C:/Users/ybka/dbms"</span>
<span class="no">dbname</span> <span class="kw">=</span> <span class="st">"geo_ssb.accdb"</span>

<span class="fu">geo_save</span>(<span class="kw">tblname</span> <span class="kw">=</span> <span class="st">"tblGeo"</span>,
         <span class="kw">obj</span> <span class="kw">=</span> <span class="no">bigDF</span>,
         <span class="kw">des.path</span> <span class="kw">=</span> <span class="no">dbpath</span>,
         <span class="kw">file.type</span> <span class="kw">=</span> <span class="st">"Access"</span>,
         <span class="kw">db.name</span> <span class="kw">=</span> <span class="no">dbname</span>)</pre></div>
</div>
<div id="change-codes" class="section level2">
<h2 class="hasAnchor">
<a href="#change-codes" class="anchor"></a>Change codes</h2>
<p>The steps above depends on two type of data ie. current valid codes which is in a <code>csv</code> format and codes that have changed in a <code>xlsx</code> format. When table for code changes isn’t available, we have to create one to be able to use the <code>geo_set()</code> function. For example granularity <em>bydel</em> has no table of code change in SSB website.</p>
<p>To create the table from the available <code>csv</code> files, we have to decide a reference column other than geo code such as <code>names</code>. Therefore this function should be used with caution. The output can be saved as <code>xlsx</code> or <code>csv</code>.</p>
<div class="sourceCode" id="cb8"><pre class="r">files = c("ssb_bydel_jan2004.csv",
          "ssb_bydel_jan2018.csv",
          "ssb_bydel_jan2020.csv")
years = c(2004, 2018, 2020)
folder = "C:/geo/bydel"
des = "C:/geo/bydel/output"

geo_change(files = files,
           years = years,
           type = "bydel",
           key.col = "name"
           folder.path = folder,
           file.type = "Excel",
           des.path = des)</pre></div>
</div>
<div id="file-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#file-structure" class="anchor"></a>File structure</h2>
<p>I would suggest to structure your files in different folders as show below:</p>
<p><img src="reference/figures/geo_dir2.PNG" alt="File structure"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/folkehelseprofil/norgeo/">https://​github.com/​folkehelseprofil/​norgeo/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/folkehelseprofil/norgeo/issues">https://​github.com/​folkehelseprofil/​norgeo/​issues</a>
</li>
<li>SSB website at <br><a href="https://www.ssb.no/offentlig-sektor/kommunekatalog">https://​www.ssb.no/​offentlig-sektor/​kommunekatalog</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Yusman Kamaleri <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Yusman Kamaleri.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
